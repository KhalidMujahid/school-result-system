<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Result</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f9fa;
    }

    .header {
      text-align: center;
      padding: 20px;
      background: linear-gradient(90deg, #4caf50, #81c784);
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card {
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .form-label {
      font-weight: 600;
    }

    .preview-img {
      max-width: 120px;
      max-height: 120px;
      border-radius: 100%;
      border: 4px solid #6c757d;
      margin: 10px auto;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <!-- Header Section -->
    <div class="header">
      <h3>UNIQUE KIDDIES SCHOOL</h3>
      <h5>Add Results for Terminal Report (Junior Secondary)</h5>
    </div>

    <!-- Personal Data Section -->
    <div class="card mt-4 p-4">
      <h4 class="text-center">Personal Data</h4>
      <form action="/submit-result" method="POST" enctype="multipart/form-data">
        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label for="fullName" class="form-label">Full Name</label>
            <input type="text" id="fullName" name="full_name" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label for="admissionNumber" class="form-label">Admission Number</label>
            <input type="text" id="admissionNumber" name="admission_number" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="year" class="form-label">Year</label>
            <input type="text" id="year" name="year" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="class" class="form-label">Class</label>
            <input type="text" id="class" name="class" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="house" class="form-label">House</label>
            <input type="text" id="house" name="house" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="age" class="form-label">Age</label>
            <input type="number" id="age" name="age" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="attendance" class="form-label">Attendance</label>
            <input type="text" id="attendance" name="attendance" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="classAverage" class="form-label">Class Average</label>
            <input type="text" id="classAverage" name="class_average" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="finalAverage" class="form-label">Final Average</label>
            <input type="text" id="finalAverage" name="final_average" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label for="term" class="form-label">Select Term</label>
          <select class="form-select" id="term" name="term" required>
            <option value="">-- Select Term --</option>
            <option value="1">First Term</option>
            <option value="2">Second Term</option>
            <option value="3">Third Term</option>
          </select>
          </div>
          <div class="col-md-4">
            <label for="photo" class="form-label">Student Photo</label>
            <input type="file" id="photo" name="photo" class="form-control" accept="image/*" onchange="previewImage(event)">
            <img id="photoPreview" src="#" alt="Photo Preview" class="preview-img d-none">
          </div>
        </div>

        <!-- Results Section -->
        <h4 class="text-center mt-4">Results</h4>
       <table class="table table-bordered text-center">
    <thead class="table-success">
      <tr>
        <th>Subject</th>
        <th>1st C.A. Test (10)</th>
        <th>Class/Home Activities (10)</th>
        <th>Mid Term Test (20)</th>
        <th>Exam (60)</th>
        <th>Final Marks (100%)</th>
        <th>Subject Average</th>
        <th>Grade</th>
        <th>Subject Position</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody id="subjects-table">
      <!-- Template for subjects -->
     </tbody>
     </table>

        <!-- Affective Traits and Comments Section -->
        <div class="row g-3 mt-4">
          <div class="col-md-6">
           <table class="table table-bordered text-center">
  <thead class="table-light">
    <tr>
      <th>Trait</th>
      <th>Rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Punctuality</td>
      <td>
        <select class="form-select" name="punctuality" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5" selected>5</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Alertness</td>
      <td>
        <select class="form-select" name="alertness" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
          <option value="5">5</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Neatness</td>
      <td>
        <select class="form-select" name="neatness" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
          <option value="5">5</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Honesty</td>
      <td>
        <select class="form-select" name="honesty" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
          <option value="5">5</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Relationship with Others</td>
      <td>
        <select class="form-select" name="relationship_with_others" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3" selected>3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Politeness</td>
      <td>
        <select class="form-select" name="politeness" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5" selected>5</option>
        </select>
      </td>
    </tr>
  </tbody>
</table>

          </div>
          <div class="col-md-6">
            <label for="formMasterComment" class="form-label">Form Master's Comment</label>
            <textarea id="formMasterComment" name="form_master_comment" rows="4" class="form-control"></textarea>
          </div>
          <div class="col-md-6">
            <label for="principalComment" class="form-label">Principal's Comment</label>
            <textarea id="principalComment" name="principal_comment" rows="4" class="form-control"></textarea>
          </div>
          <div class="col-md-6">
            <label for="nextTermBegins" class="form-label">Next Term Begins</label>
            <input type="date" id="nextTermBegins" name="next_term_begins" class="form-control">
          </div>
        </div>

        <div class="text-center mt-4">
          <button type="submit" class="btn btn-success px-5">Submit Results</button>
        </div>
      </form>
    </div>
  </div>

  <script>
  function previewImage(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      const preview = document.getElementById("photoPreview");

      reader.onload = () => {
        preview.src = reader.result;
        preview.classList.remove("d-none");
      };

      if (file) reader.readAsDataURL(file);
    }
    
     function calculatePositionAndRemarks() {
      const rows = Array.from(document.querySelectorAll("#subjects-table tr"));
      const finalMarksArray = rows.map(row => {
        const finalMarks = parseFloat(row.querySelector(".final-marks").value) || 0;
        return { row, finalMarks };
      });

      // Sort subjects by final marks in descending order
      finalMarksArray.sort((a, b) => b.finalMarks - a.finalMarks);

      // Assign position and remarks
      finalMarksArray.forEach((item, index) => {
        const positionField = item.row.querySelector(".position");
        const remarkField = item.row.querySelector(".remark");
        const finalMarks = item.finalMarks;

        // Assign position
        positionField.value = `${index + 1}`;

        // Assign remarks based on final marks
        if (finalMarks >= 75) {
          remarkField.value = "Excellent";
        } else if (finalMarks >= 60) {
          remarkField.value = "Very Good";
        } else if (finalMarks >= 50) {
          remarkField.value = "Good";
        } else if (finalMarks >= 40) {
          remarkField.value = "Pass";
        } else {
          remarkField.value = "Fail";
        }
      });
    }

    document.addEventListener("input", function(event) {
      if (event.target.classList.contains("score-input")) {
        const row = event.target.closest("tr");
        const inputs = row.querySelectorAll(".score-input");
        const finalMarksField = row.querySelector(".final-marks");
        const subjectAverageField = row.querySelector(".subject-average");
        const gradeField = row.querySelector(".grade");

        let totalMarks = 0;

        // Calculate total marks based on weights
        inputs.forEach(input => {
          const value = parseFloat(input.value) || 0;
          const weight = parseInt(input.dataset.weight, 10);
          totalMarks += value;
        });

        // Set the final marks (out of 100)
        finalMarksField.value = totalMarks.toFixed(2);

        // Calculate and set subject average
        subjectAverageField.value = (totalMarks / 100 * 100).toFixed(2);

        // Determine and set grade
        if (totalMarks >= 75) {
          gradeField.value = "A";
        } else if (totalMarks >= 60) {
          gradeField.value = "B";
        } else if (totalMarks >= 50) {
          gradeField.value = "C";
        } else if (totalMarks >= 40) {
          gradeField.value = "D";
        } else {
          gradeField.value = "F";
        }
      }
    });
    
    // Array of subjects
const subjects = [
  'Mathematics', 'English Studies', 'National Values', 'Basic Science', 'Basic Technology', 
  'Cultural and Creative Art', 'Agricultural Science', 'Home Economics', 
  'Literature in English', 'Computer Studies', 'Business Studies', 
  'IRS', 'P.H.E.'
];

// later use
//const subjectsToAdd = [
 // 'Mathematics', 'English Studies', 'National Values', 'Basic Science', 'Basic Technology', 
 // 'Cultural and Creative Art', 'Agricultural Science', 'Hausa', 'Home Economics', 
 // 'Literature in English', 'History', 'Computer Studies', 'Business Studies', 
 // 'IRS', 'CRS', 'P.H.E.','French','Arabic Studies'
//];

// Target the table body
const subjectsTable = document.getElementById('subjects-table');

// Loop through the subjects array and generate rows
subjects.forEach(subject => {
  // Create a table row
  const row = document.createElement('tr');

  // Define the inner HTML for the row
  row.innerHTML = `
    <td>${subject}</td>
    <td><input type="number" name="${subject.toLowerCase().replace(/ /g, '_')}_first" class="form-control score-input" data-weight="10" required></td>
    <td><input type="number" name="${subject.toLowerCase().replace(/ /g, '_')}_second" class="form-control score-input" data-weight="10" required></td>
    <td><input type="number" name="${subject.toLowerCase().replace(/ /g, '_')}_mid" class="form-control score-input" data-weight="20" required></td>
    <td><input type="number" name="${subject.toLowerCase().replace(/ /g, '_')}_exam" class="form-control score-input" data-weight="60" required></td>
    <td><input type="number" name="${subject.toLowerCase().replace(/ /g, '_')}_final" class="form-control readonly final-marks" readonly></td>
    <td><input type="number" name="${subject.toLowerCase().replace(/ /g, '_')}_subject_average" class="form-control readonly subject-average" readonly></td>
    <td><input type="text" name="${subject.toLowerCase().replace(/ /g, '_')}_grade" class="form-control readonly grade" readonly></td>
    <td><input type="number" name="${subject.toLowerCase().replace(/ /g, '_')}_position" class="form-control position" placeholder="Position"></td>
    <td><input type="text" name="${subject.toLowerCase().replace(/ /g, '_')}_remark" class="form-control readonly remark" readonly></td>
  `;

  subjectsTable.appendChild(row);
});

  </script>
</body>
</html>


