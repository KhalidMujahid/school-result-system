<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Report Card</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
body {
  font-family: 'Roboto', sans-serif;
  background-color: #f8f9fa;
  margin: 0;
  padding: 0;
  position: relative;

}

.container {
  width: 100%;
  max-width: 210mm;
  height: 297mm; 
  padding: 10mm;
  background-color: white;
  position: relative;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

/* Watermark for School Logo */
body::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-image: url('logo.jpg'); 
  background-repeat: no-repeat;
  background-size: 60%;  /* Increased size of logo */
  z-index: -1;
  width: 100%;
  height: 100%;
}

/* Header Section */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 5px;
  background: linear-gradient(90deg, #4caf50, #81c784);
  color: white;
  border-radius: 8px;
  margin-bottom: 5px;
}

.header .school-info {
  flex: 1;
  text-align: center;
  padding: 0 5px;
}

.header .logo-left {
  width: 80px;  /* Increased size of school logo */
  height: 80px;  /* Increased size of school logo */
  border-radius: 50%;
  border: 2px solid white;
  object-fit: cover;
}

.header .student-avatar {
  width: 100px;  /* Increased size of student photo */
  height: 100px;  /* Increased size of student photo */
  border-color: #6c757d;
}

/* Student Details */
#studentDetails {
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  padding: 5px;
  margin-bottom: 5px;
  font-size: 10px;
}

#studentDetails p {
  margin: 0;
  padding: 2px 0;
  border-bottom: 1px solid #e9ecef;
}

#studentDetails p:last-child {
  border-bottom: none;
}

/* Table Styles */
.table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 5px;
}

.table th,
.table td {
  border: 1px solid #dee2e6;
  padding: 4px;
  text-align: center;
  font-size: 9px;
}

.table th {
  background-color: #f8f9fa;
  font-weight: bolder;
}

.table-hover tbody tr:hover {
  background-color: #e9f5e8;
}

/* Remarks and Key Sections */
.remarks-section,
.key-rating-section {
  margin-bottom: 5px;
}

.remarks-section h5,
.key-rating-section h5 {
  font-size: 0.8rem;
  font-weight: bold;
  color: #495057;
}

.key-rating-section table,
.remarks-section table {
  background-color: #ffffff;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.key-rating-section td,
.remarks-section td {
  font-size: 8px;
  padding: 4px;
}

/* Comments Section */
.comments {
  margin-top: 5px;
}

.comments p {
  background: #fef9e7;
  padding: 4px;
  border-radius: 4px;
  margin-bottom: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.comments strong {
  font-weight: bold;
}

/* Print Styles */
@media print {
  body {
    margin: 0;
    padding: 0;
    background: white;
    overflow: hidden;
  }

  .header {
    padding: 5px;
    font-weight: bold;  /* Added bold text for header */
  }

  .header .logo-left,
  .header .student-avatar {
    width: 60px;  /* Adjusted size for print */
    height: 60px;  /* Adjusted size for print */
  }

  .table th,
  .table td {
    font-size: 10px;
    padding: 3px;
    font-weight: thin; 
  }

  #studentDetails,
  .remarks-section,
  .key-rating-section,
  .comments {
    page-break-inside: avoid;
  }

  @page {
    size: A4;
    margin: 0;
  }

  .key-rating-section h6,
  .key-rating-section span {
    font-weight: bolder; 
  }

  .comments p,
  .school-info h2,
  .school-info p {
    font-weight: bolder; 
  }
}

  </style>
</head>
<body>
  <div class="container py-4" id="reportCardContainer">
 <div class="report-card">
  <!-- Header -->
  <div class="header d-flex justify-content-between align-items-center p-4 rounded shadow bg-light">
    <!-- School Logo -->
    <img src="/logo.jpg" alt="School Logo" class="logo-left rounded-circle">

    <!-- School Info -->
    <div class="school-info text-center">
      <h2 class="fw-bold text-uppercase text-primary">Unique Kiddies School</h2>
      <p class="small text-muted">
        Nursery, Primary and Secondary School<br />
        Off Mrs. Lami Makun Street, Kwalkwata, Minna, Niger State
      </p>
      <h5 class="fw-semibold text-dark">Terminal Report Sheet (Junior Secondary)</h5>
    </div>

    <!-- Student Avatar -->
    <img src="av.jpg" alt="Student Avatar" class="student-avatar rounded shadow">
  </div>

  <!-- Student Details Section -->
  <div class="student-details row bg-white rounded shadow-sm my-4 p-4">
    <!-- Student Name -->
    <div class="col-md-4 text-center">
      <p class="mb-2"><strong>Student Name:</strong></p>
      <p class="fw-bold text-secondary" id="studentName">[Student Name]</p>
    </div>
    <!-- Other Details -->
    <div class="col-md-8">
      <div class="row">
        <div class="col-md-6">
          <p><strong>Admission No:</strong> <span id="admissionNumber">12345</span></p>
          <p><strong>Age:</strong> <span id="age">12</span></p>
          <p><strong>Attendance:</strong> <span id="attendance">15/20</span></p>
        </div>
        <div class="col-md-6">
          <p><strong>Student Average:</strong> <span id="finalAverage">80%</span></p>
          <p><strong>Class Average:</strong> <span id="classAverage">75%</span></p>
          <p><strong>House:</strong> <span id="house">Blue</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Subjects Table -->
  <table class="table table-bordered table-striped text-center shadow-sm mb-4" id="subjectsTable">
    <thead class="table-light">
      <tr>
        <th>Subject</th>
        <th>1st C.A. Test (10)</th>
        <th>Class/Home Activities (10)</th>
        <th>Mid Term Test (20)</th>
        <th>Exam (60)</th>
        <th>Final Marks (100%)</th>
        <th>Grade</th>
        <th>Subject Position</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows dynamically injected -->
    </tbody>
    <tfoot>
      <tr>
        <td colspan="5" class="text-end fw-bold">Total Marks:</td>
        <td id="totalMarks">0</td>
        <td colspan="4"></td>
      </tr>
    </tfoot>
  </table>

  <!-- Affective Traits and Key Rating -->
  <div class="row mb-4">
    <div class="col-md-6">
      <h5>Affective Traits</h5>
      <table class="table table-bordered text-center shadow-sm">
        <thead class="table-light">
          <tr>
            <th>Trait</th>
            <th>Rating</th>
          </tr>
        </thead>
        <tbody id="traitsTable">
          <!-- Dynamic content -->
        </tbody>
      </table>
    </div>
    <div class="col-md-6">
      <h5>Key Rating</h5>
      <div class="key-rating d-flex flex-wrap justify-content-between">
        <div class="rating-item">
          <strong>A</strong> - 75-100
        </div>
        <div class="rating-item">
          <strong>B</strong> - 60-74
        </div>
        <div class="rating-item">
          <strong>C</strong> - 50-59
        </div>
        <div class="rating-item">
          <strong>D</strong> - 40-49
        </div>
        <div class="rating-item">
          <strong>F</strong> - 0-39
        </div>
      </div>
    </div>
  </div>

  <!-- Comments Section -->
  <div class="comments p-4 bg-light rounded shadow-sm">
    <p><strong>Form Master's Comment:</strong> <span id="master_comment">Excellent performance!</span></p>
    <p><strong>Principal's Comment:</strong> <span id="principal_comment">Keep it up!</span></p>
    <p><strong>Next Term Begins:</strong> <span id="next_term_begins">January 10, 2025</span></p>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const url = window.location.pathname;
    const urlParts = url.split("/");
    const admissionNumber = urlParts[2];
    const term = urlParts[3];

    // Fetch the result data
    fetch(`/fetch-result/${admissionNumber}/${term}`)
      .then((response) => {
        if (!response.ok) {
          if (response.status === 404) {
            alert("No data found for this admission number and term.");
            window.location.href = "/results";
          }
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        // Populate student details
        document.getElementById("studentName").textContent = data.full_name || "N/A";
        document.getElementById("master_comment").textContent = data.form_master_comment || "N/A";
        document.getElementById("principal_comment").textContent = data.principal_comment || "N/A";
        document.getElementById("next_term_begins").textContent = data.next_term_begins || "N/A";
        document.getElementById("admissionNumber").textContent = data.admission_number || "N/A";
        document.getElementById("age").textContent = data.age || "N/A";
        document.getElementById("attendance").textContent = `${data.attendance || "N/A"}`;
        document.getElementById("finalAverage").textContent = `${data.final_average || "N/A"}`;
        document.getElementById("classAverage").textContent = `${data.class_average || "N/A"}`;
        document.getElementById("house").textContent = data.house || "N/A";

        // Update student avatar if a photo path exists
        if (data.photo_path) {
          document.querySelector(".student-avatar").src = `/uploads/${data.photo_path}`;
        }

        // Populate subjects table
        const subjectsTableBody = document
          .getElementById("subjectsTable")
          .getElementsByTagName("tbody")[0];
        subjectsTableBody.innerHTML = "";

        let totalMarks = 0;
        data.results.forEach((result) => {
          const row = subjectsTableBody.insertRow();
          row.innerHTML = `
            <td>${result.subject}</td>
            <td>${result.first_assessment || 0}</td>
            <td>${result.second_assessment || 0}</td>
            <td>${result.mid_term_test || 0}</td>
            <td>${result.exam || 0}</td>
            <td>${result.total_marks || 0}</td>
            <td>${result.grade || "-"}</td>
            <td>${result.position || "-"}</td>
            <td>${result.remark || "-"}</td>
          `;

          if (!isNaN(result.total_marks)) {
            totalMarks += parseFloat(result.total_marks);
          }
        });
        document.getElementById("totalMarks").textContent = totalMarks;

        // Insert traits data
        const traitsTableBody = document.getElementById("traitsTable");
        traitsTableBody.innerHTML = "";
        const traits = [
          { name: "Punctuality", rating: data.punctuality },
          { name: "Alertness", rating: data.alertness },
          { name: "Neatness", rating: data.neatness },
          { name: "Honesty", rating: data.honesty },
          { name: "Relationship with Others", rating: data.relationship_with_others },
          { name: "Politeness", rating: data.politeness },
        ];

        traits.forEach((trait) => {
          const row = traitsTableBody.insertRow();
          row.innerHTML = `
            <td>${trait.name}</td>
            <td>${trait.rating || "-"}</td>
          `;
        });
      })
      .catch((error) => {
        console.error("Error fetching student data:", error);
      });
  });
</script>



</body>
</html>
